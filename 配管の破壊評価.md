# 4.4 配管の破壊評価の例題
## 設問4.1(P390)　配管の塑性崩壊モーメント
テキストに設定されている条件を辞書形式で以下のように定義する。
```python
#設問4.1
import numpy as np
S0=313.6
E=192.08e3
R=53e-3
a=28e-3
th=a/R
C=1.176
m=0.44
da=0.25e-3
JR=C*da**m
data={'R':R,
    't':9e-3,
    'th':th,
    'M':2.594e-2,
    'P':0.0,
    'n':7.0,
    'E':E,
    'Nu':0.3,
    'Sy':S0,
    'Su':490.0,
    'S0':S0,
    'e0':S0/E,
    'alpha':5.5,
    'plane':'strain',
    'MR':True,
    'JR':JR,
    'Su':490.0,
    'J1c':0.784e3
    }
```
キーの変数文字列は，テキストの記号と対応づけている。この中でJRはテキストのJ積分抵抗値に対応している。単位系は，一貫して用いるよう注意すること。長さはm，荷重はMNを用いている。まず，最初にやるべきことは，解析のためのインスタンスを生成することである。
```python
from FFSeval import FFS as ffs
cls=ffs.Treat()
```
この操作は毎回最初に一回だけ実施する必要がある。ZahoorのJ値解を用いることとする。節番号は，J-2-k-aであるので，この処理のためのインスタンスを下記により設定する。
```python
J=cls.Set('J-2-k-a')
```
データをセットし，解析実行して結果を取り出す手順は以下の通り。
```python
J.SetData(data)
J.Calc()
rr=J.GetRes()
rr
```
この結果以下が出力されることを確認されたい。
```
{'MR': 0.01754167220356631,
 'M0': 0.02261990748881312,
 'H1': 0.7206518000613691}
 ```
 ここで，MRは崩壊モーメント抵抗値，M0は崩壊モーメント，H1は，テキストに与えられる表から内挿により評価した値である。なお，内挿法としてKriging法を採用している。テキストの解答はP396にM0=2.909 x 10^4Nmと与えられているのに対して，上記の結果はM0=2.262 x 10^4Nm$と若干の相違を示している。この差異は，H1の内挿値の差異と思われる。解析が終了してJが不要になった段階で必ずJを下記により消滅させておくこと。そうでないと，いつまでもメモリに残ってしまう。
 ```python
 del J
 ```

 ## 設問4.2(P390)　配管の破壊荷重をJ積分(全面塑性解)から算出する
 亀裂長さを28mmから36mmまで連続的に進展させて，計算させるプログラムは以下の通りである。
 ```python
 #設問4.2
a=[28.0,30.0,32.0,34.0,36.0]
a0=(28.0-0.25)/1e3
res=[]
for aa in a:
    aa=aa/1e3
    J=cls.Set('J-2-k-a')
    da=(aa-a0)*1e3
    JR=C*da**m
    th=aa/R
    data['th']=th
    data['JR']=JR
    J.SetData(data)
    J.Calc()
    rr=J.GetRes()
    rr['a']=aa
    rr['da']=da
    rr['JR']=JR
    res.append(rr)
    del J
res
```
この結果以下の出力が得られることを確認されたい。
```
[{'MR': 0.025649032731004693,
  'M0': 0.02261990748881312,
  'H1': 0.7206517926105551,
  'a': 0.028,
  'da': 0.2500000000000002,
  'JR': 0.6390000991653223},
 {'MR': 0.02811746369011001,
  'M0': 0.021947285368052794,
  'H1': 0.7346909559791527,
  'a': 0.03,
  'da': 2.2499999999999987,
  'JR': 1.6802257251729233},
 {'MR': 0.028274155181733405,
  'M0': 0.02127593071271553,
  'H1': 0.7468096677454259,
  'a': 0.032,
  'da': 4.25,
  'JR': 2.2227900853222695},
 {'MR': 0.02802759912954658,
  'M0': 0.020606615210001723,
  'H1': 0.757343784817128,
  'a': 0.034,
  'da': 6.250000000000002,
  'JR': 2.633871174749357},
 {'MR': 0.02760148122765062,
  'M0': 0.019940096133781334,
  'H1': 0.766564391593418,
  'a': 0.036,
  'da': 8.249999999999996,
  'JR': 2.9760968425741243}]
  ```
  解答例がテキストのP396の表に掲載されているので比較されたい。モーメント抵抗値MRがテキストの表のMに対応している。テキストの表の値は，上記結果と若干異なるものの，これはH1の内挿値の差異によるものと推察される。しかし，亀裂進展量4.25mmのときに，MRが最大になることは対応している。

  ## 設問4.3 2パラメータ法による破壊評価

  ### ケース1
  #### Kr値の評価
  入力データ準備
  ```python
  import numpy as np
S0=313.6
E=192.08e3
R=60e-3
th=30.0*np.pi/180.0
c=R*th
C=1.176
m=0.44
da=0.25e-3
JR=C*da**m
data={'R':R,
      'c':c,
    't':10e-3,
    'th':th,
    'M':1.96e-2,
    'P':0.0,
    'n':7.0,
    'E':E,
    'Nu':0.3,
    'Sy':S0,
    'Su':490.0,
    'S0':S0,
    'e0':S0/E,
    'alpha':5.5,
    'plane':'strain',
    'MR':True,
    'JR':JR,
    'J1c':0.784
    }
```
インスタンスの生成，Krの評価
```python
from FFSeval import FFS as ffs
cls=ffs.Treat()
K=cls.Set('K-2-k-2')
print(K.Title())
K.SetData(data)
K.Calc()
res=K.GetRes()
Kr=res['K']/K.CalcKc()
print(f'Kr={Kr}')
```
その結果以下を得る。
```
Kr=0.16091515878476811
```
#### Lr値の評価
```python
J=cls.Set('J-2-k-a')
J.SetData(data)
J.Calc()
res=J.GetRes()
Lr=data['M']/res['M0']
print('Lr=',Lr)
```
その結果以下を得る。
```
Lr= 0.6062468510565101
```
#### 安全裕度の評価
```python
margin=J.Margin(Kr,Lr)['margin']
print(f'Marin={margin}')
```
その結果以下を得る。
```
Marin=0.5047594722372478
```
Marginが1以下なので，安全領域にあることが確認できる。

### ケース2
#### Kr値の評価
データ準備
```python
import numpy as np
S0=313.6
E=192.08e3
R=200e-3
th=30.0*np.pi/180.0
c=R*th
C=1.176
m=0.44
da=0.25e-3
JR=C*da**m
data={'R':R,
      'c':c,
    't':16e-3,
    'th':th,
    'M':7.84e-1,
    'P':0.0,
    'n':7.0,
    'E':E,
    'Nu':0.3,
    'Sy':S0,
    'Su':490.0,
    'S0':S0,
    'e0':S0/E,
    'alpha':5.5,
    'plane':'strain',
    'MR':True,
    'JR':JR,
    'J1c':0.784
    }
```
解析
```python
from FFSeval import FFS as ffs
cls=ffs.Treat()
K=cls.Set('K-2-k-2')
K.SetData(data)
K.Calc()
res=K.GetRes()
#Kval=unit.Eval('MPa_m^1/2','N/mm^3/2',res['K'])
Kr=res['K']/K.CalcKc()
```

#### Lr値の評価
```python
J=cls.Set('J-2-k-a')
J.SetData(data)
J.Calc()
res=J.GetRes()
Lr=data['M']/res['M0']
```
安全裕度の評価
```python
margin=J.Margin(Kr,Lr)['margin']
print(f'Kr,Lr,margin={Kr,Lr,margin}')
```
その結果，以下を得る。
```python
Kr,Lr,margin=(0.7565161160740169, 1.3640554148771478, 1.3519304104235883)
```
Marginが1を超過しているので，破損領域にあることが確認できる。



